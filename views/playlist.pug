extends layout

block content
    a.m-2.float-sm-right.btn.btn-primary(href='/playlists/' + playlist.id + '/export') Export
    a.m-2.float-sm-right.btn.btn-primary(href='/playlists/' + playlist.id + '/convert') Convert to MP3
    a.m-2.float-sm-right.btn.btn-primary(href='/playlists/' + playlist.id + '/upload') Upload to S3
    a.m-2.float-sm-right.btn.btn-primary(href='/playlists/' + playlist.id + '/refresh') Refresh playlist

    a(href='/playlists') < YT playlists

    h1= playlist.title
    p
        | Status:&nbsp;
        em= playlist.status
        | &nbsp;&nbsp;Video count:&nbsp;
        em= items.length

    h2 Album settings

    .row
        .col-sm-6
            form(method='post', encType='multipart/form-data', action='/playlists/' + playlist.id + '/metadata')
                .form-group.row
                    label.col-form-label.col-sm-2(for='album_' + playlist.id) Album title
                    .col-sm-10
                        input.form-control(type='text', id='album_' + playlist.id, name='album', value=playlist.album_name)
                .form-group.row
                    label.col-form-label.col-sm-2(for='album_cover_' + playlist.id) Album cover
                    .col-sm-10
                        input.form-control(type='file', id='album_cover_' + playlist.id, name='image_file')
                .form-group.row
                    .col-sm-10
                        input.btn.btn-primary(type='submit', value='Save')
        .col-sm-6
            if playlist.coverImageUrl()
                img(src=playlist.coverImageUrl(), width=300)

    .row
        each item, i in items
            .col-lg-6
                .card.my-3.p-3
                    h5= i + 1 + '. ' + item.title
                    .row
                        .col-sm-3
                            small
                                = item.metadata.channelTitle
                                a.float-sm-right(href='https://www.youtube.com/watch?v=' + item.id)= item.id
                            - playableUrl = (item.mp3Upload && item.mp3Upload.S3Url()) || (item.upload && item.upload.S3Url()) || ('https://audio.adikus.me/yt/' + item.id)
                            play-audio-image(image-src=item.metadata.thumbnails.default.url, title=item.title, url=playableUrl, @play="playTrack")
                        .col-sm-4
                            h6 Status & Uploads
                            div
                                form(method='post', encType='multipart/form-data', action='/playlist-videos/' + item.playlistVideo.id + '/remove')
                                    .row.mb-2
                                        .col-sm-6
                                            em= item.playlistVideo.status
                                        .col-sm-6
                                            if item.playlistVideo.status !== 'removed'
                                                input.btn.btn-sm.btn-secondary(type='submit', value='Remove')
                                            else
                                                input.btn.btn-sm.btn-secondary(type='submit', value='Unremove')
                            .row.mb-2
                                .col-sm-6
                                    if item.originalUpload
                                        a(href=item.originalUpload.S3Url())= item.originalUpload.file_type
                                .col-sm-6
                                    a.btn.btn-sm.btn-secondary(href='/videos/' + item.id + '/upload') (Re)Upload
                            .row.mb-2
                                .col-sm-6
                                    if item.mp3Upload
                                        a(href=item.mp3Upload.S3Url()) mp3
                                .col-sm-6
                                    a.btn.btn-sm.btn-secondary(href='/videos/' + item.id + '/convert') (Re)Convert
                            if !item.mp3Upload
                                form(method='post', encType='multipart/form-data', action='/playlist-videos/' + item.playlistVideo.id + '/upload-mp3')
                                    .form-group.row.mb-2
                                        .col-sm-6
                                            input.form-control.form-control-sm(type='file', name='mp3_file')
                                        .col-sm-6
                                            input.btn.btn-secondary.btn-sm(type='submit', value='Upload mp3')
                            each customUpload, _ in item.customUploads
                                div.mb-2
                                    a(href=customUpload.upload.S3Url())= customUpload.type

                        - guessed = item.playlistVideo.guessMetadata()
                        - has_metadata = item.playlistVideo.artist && item.playlistVideo.title
                        div(class='col-sm-5 metadata-cell ' + (has_metadata ? 'has-metadata' : 'no-metadata'))
                            h6 Metadata
                            form(method='post', action='/playlist-videos/' + item.playlistVideo.id + '/metadata')
                                .form-group.row.mb-0
                                    label.col-form-label.col-sm-4(for='artist_' + item.id) Artist
                                    .col-sm-6
                                        input.form-control.form-control-sm(type='text', id='artist_' + item.id, name='artist', value=item.playlistVideo.artist || (guessed && guessed.artist))
                                .form-group.row.mb-0
                                    label.col-form-label.col-sm-4(for='title_' + item.id) Title
                                    .col-sm-6
                                        input.form-control.form-control-sm(type='text', id='title_' + item.id, name='title', value=item.playlistVideo.title || (guessed && guessed.title))
                                .form-group.row.mb-0
                                    label.col-form-label.col-sm-4(for='genre_' + item.id) Genre
                                    .col-sm-6
                                        input.form-control.form-control-sm(type='text', id='genre_' + item.id, name='genre', value=item.playlistVideo.genre || (guessed && guessed.genre))
                                .form-group.row.mb-0
                                    .col-sm-6
                                        input.btn.btn-primary.btn-sm.submit.js-metadata-save(type='submit', value='Save')
                                .js-metadata-save-message

block footer
    footer.footer(v-if="title")
        .container-fluid
            audio-controller(:title="title", :url="url", @play="url=null")
